import{r as w,ac as le,j as P,R as Z,ad as re,ae as ce,o as D,d as A,V as z,L as F,u as ue,i as de,v as b,x as y,y as e,A as E,B as T,af as pe,G as p,I as K,Q as O,S,T as L,O as J,ag as me,ah as he,ai as fe}from"./DPxB2w_0.js";import{u as U}from"./Kw-0CWFx.js";import{t as Y,d as _e,i as ve,n as we,e as ge,f as q,a as Q,c as ee,s as x}from"./Dg45MdiV.js";import{a as se}from"./DEefp4d8.js";import{s as X}from"./_kJ-WLyv.js";function ke(u){var n;const i=q(u);return(n=i==null?void 0:i.$el)!=null?n:i}const V=ve?window:void 0;function te(...u){let n,i,r,t;if(typeof u[0]=="string"||Array.isArray(u[0])?([i,r,t]=u,n=V):[n,i,r,t]=u,!n)return we;Array.isArray(i)||(i=[i]),Array.isArray(r)||(r=[r]);const s=[],o=()=>{s.forEach(a=>a()),s.length=0},c=(a,l,h,_)=>(a.addEventListener(l,h,_),()=>a.removeEventListener(l,h,_)),d=Z(()=>[ke(n),q(t)],([a,l])=>{if(o(),!a)return;const h=ge(l)?{...l}:l;s.push(...i.flatMap(_=>r.map(v=>c(a,_,v,h))))},{immediate:!0,flush:"post"}),m=()=>{d(),o()};return Y(m),m}function be(){const u=w(!1),n=ce();return n&&D(()=>{u.value=!0},n),u}function ye(u){const n=be();return P(()=>(n.value,!!u()))}function $e(u,n={}){const{immediate:i=!0,fpsLimit:r=void 0,window:t=V}=n,s=w(!1),o=r?1e3/r:null;let c=0,d=null;function m(h){if(!s.value||!t)return;c||(c=h);const _=h-c;if(o&&_<o){d=t.requestAnimationFrame(m);return}c=h,u({delta:_,timestamp:h}),d=t.requestAnimationFrame(m)}function a(){!s.value&&t&&(s.value=!0,c=0,d=t.requestAnimationFrame(m))}function l(){s.value=!1,d!=null&&t&&(t.cancelAnimationFrame(d),d=null)}return i&&a(),Y(l),{isActive:le(s),pause:l,resume:a}}function xe(u,n={}){const{window:i=V}=n,r=ye(()=>i&&"matchMedia"in i&&typeof i.matchMedia=="function");let t;const s=w(!1),o=m=>{s.value=m.matches},c=()=>{t&&("removeEventListener"in t?t.removeEventListener("change",o):t.removeListener(o))},d=re(()=>{r.value&&(c(),t=i.matchMedia(q(u)),"addEventListener"in t?t.addEventListener("change",o):t.addListener(o),s.value=t.matches)});return Y(()=>{d(),c(),t=void 0}),s}function Me(u={}){const{window:n=V,behavior:i="auto"}=u;if(!n)return{x:w(0),y:w(0)};const r=w(n.scrollX),t=w(n.scrollY),s=P({get(){return r.value},set(c){scrollTo({left:c,behavior:i})}}),o=P({get(){return t.value},set(c){scrollTo({top:c,behavior:i})}});return te(n,"scroll",()=>{r.value=n.scrollX,t.value=n.scrollY},{capture:!1,passive:!0}),{x:s,y:o}}function Se(u={}){const{window:n=V,initialWidth:i=Number.POSITIVE_INFINITY,initialHeight:r=Number.POSITIVE_INFINITY,listenOrientation:t=!0,includeScrollbar:s=!0}=u,o=w(i),c=w(r),d=()=>{n&&(s?(o.value=n.innerWidth,c.value=n.innerHeight):(o.value=n.document.documentElement.clientWidth,c.value=n.document.documentElement.clientHeight))};if(d(),_e(d),te("resize",d,{passive:!0}),t){const m=xe("(orientation: portrait)");Z(m,()=>d())}return{width:o,height:c}}const Ce={class:"global-nav"},Le={class:"wrap"},Ae={class:"left-part"},Re=e("i",{class:"icon icon-nav-logo"},null,-1),Ie=e("span",{class:"hidden"},"M.M.F 小屋",-1),Be={class:"main-nav"},Ee=e("i",{class:"icon icon-nav-home"},null,-1),Te=e("span",{class:"text"},"首页",-1),Pe=e("i",{class:"icon icon-nav-explore"},null,-1),Ve=e("span",{class:"text"},"热门",-1),We=e("i",{class:"icon icon-nav-features"},null,-1),je=e("span",{class:"text"},"关于",-1),ze=e("a",{href:"https://handle.mmxiaowu.com/",target:"_blank",class:"nav-link"},[e("i",{class:"icon icon-nav-game"}),e("span",{class:"text"},"汉兜")],-1),Fe={key:0,class:"right-part"},Ne={class:"nav-search"},Oe=e("i",{class:"icon icon-search-white"},null,-1),Ue={key:0,class:"nav-me"},Ye=["src"],qe={key:1,class:"nav-me"},He=["src"],Is=A({name:"GlobalNavigation",__name:"global-navigation",props:{isBackend:{type:Boolean}},setup(u){const i=z(u),r=F(i,"isBackend"),t=U(),s=z(t),o=F(s,"cookies"),c=P(()=>!!o.value.user);function d(){t.setLoginModal(!0)}const m=ue();function a(l){const h=l.target.value;if(h==="")return!1;m.replace(`/search/${h}`)}return(l,h)=>{const _=de("router-link");return b(),y("nav",Ce,[e("div",Le,[e("div",Ae,[E(_,{to:"/","active-class":"current",exact:"",class:"logo-link"},{default:T(()=>[Re,Ie]),_:1}),e("div",Be,[E(_,{to:"/","active-class":"current",exact:"",class:"nav-link"},{default:T(()=>[Ee,Te]),_:1}),E(_,{to:"/trending/visit","active-class":"current",class:"nav-link"},{default:T(()=>[Pe,Ve]),_:1}),E(_,{to:"/about","active-class":"current",class:"nav-link"},{default:T(()=>[We,je]),_:1}),ze])]),r.value?K("",!0):(b(),y("div",Fe,[e("span",Ne,[Oe,e("input",{placeholder:"记得按回车哦",name:"search",class:"nav-search-input",onKeyup:h[0]||(h[0]=pe(v=>a(v),["enter"]))},null,32)]),p(c)?(b(),y("span",Ue,[E(_,{to:"/user/account",class:"nav-me-link"},{default:T(()=>[e("img",{src:("useAvatar"in l?l.useAvatar:p(Q))(o.value.useremail,100),class:"nav-avatar-img"},null,8,Ye)]),_:1})])):(b(),y("span",qe,[e("a",{href:"javascript:;",class:"nav-me-link",onClick:d},[e("img",{src:("useAvatar"in l?l.useAvatar:p(Q))("noavatar"),class:"nav-avatar-img"},null,8,He)])]))]))])])}}}),Ge=e("span",{class:"center-helper"},null,-1),Qe={class:"modal modal-signup"},Xe=e("h2",{class:"modal-title"},"登录",-1),Ze=e("i",{class:"icon icon-close-black"},null,-1),De=[Ze],Ke={class:"modal-content"},Je={class:"sign-up-form"},es={class:"input-wrap"},ss=e("p",{class:"error-info input-info hidden"},"长度至少 6 位",-1),ts={class:"input-wrap"},ns=e("p",{class:"error-info input-info hidden"},"长度至少 6 位",-1),Bs=A({name:"SignIn",__name:"sign-in",props:{show:{type:Boolean}},setup(u){const i=z(u),r=F(i,"show"),t=U(),s=O({username:"",password:""});function o(){t.setLoginModal(!1)}function c(){t.setLoginModal(!1),t.setRegisterModal(!0)}const d=ee(async()=>{if(!s.username||!s.password)return x("请将表单填写完整!");const{code:m,message:a}=await se().$post("/api/frontend/user/login",{},{body:s});m===200&&(x({type:"success",content:a}),window.location.reload())});return(m,a)=>(b(),y("div",{class:J(["modal-wrap modal-sign-in-wrap",r.value?"active":""])},[Ge,e("div",Qe,[Xe,e("a",{href:"javascript:;",class:"modal-close",onClick:o},De),e("div",Ke,[e("form",Je,[e("div",es,[S(e("input",{"onUpdate:modelValue":a[0]||(a[0]=l=>p(s).username=l),type:"text",placeholder:"昵称",class:"base-input",name:"username"},null,512),[[L,p(s).username]]),ss]),e("div",ts,[S(e("input",{"onUpdate:modelValue":a[1]||(a[1]=l=>p(s).password=l),type:"password",placeholder:"密码",class:"base-input",autocomplete:"off",name:"password"},null,512),[[L,p(s).password]]),ns]),e("a",{href:"javascript:;",class:"btn sign-up-btn btn-yellow",onClick:a[2]||(a[2]=(...l)=>p(d)&&p(d)(...l))},"确认登录"),e("a",{href:"javascript:;",class:"btn sign-up-btn btn-blue block",onClick:c},"我要注册")])])])],2))}}),os=e("span",{class:"center-helper"},null,-1),as={class:"modal modal-signup"},is=e("h2",{class:"modal-title"},"注册",-1),ls=e("i",{class:"icon icon-close-black"},null,-1),rs=[ls],cs={class:"modal-content"},us={class:"sign-up-form"},ds={class:"input-wrap"},ps=e("p",{class:"error-info input-info hidden"},"长度至少 6 位",-1),ms={class:"input-wrap"},hs=e("p",{class:"error-info input-info hidden"},"长度至少 6 位",-1),fs={class:"input-wrap"},_s=e("p",{class:"error-info input-info hidden"},"长度至少 6 位",-1),vs={class:"input-wrap"},ws=e("p",{class:"error-info input-info hidden"},"长度至少 6 位",-1),Es=A({name:"SignUp",__name:"sign-up",props:{show:{type:Boolean}},setup(u){const i=z(u),r=F(i,"show"),t=U(),s=O({username:"",email:"",password:"",re_password:""});function o(){t.setRegisterModal(!1)}function c(){t.setLoginModal(!0),t.setRegisterModal(!1)}const d=ee(async()=>{const m=/^([a-zA-Z0-9_\-.]+)@([a-zA-Z0-9_-]+)(\.[a-zA-Z0-9_-]+)$/i;if(!s.username||!s.password||!s.email)return x("请将表单填写完整!");if(X(s.username)<4)return x("用户长度至少 2 个中文或 4 个英文!");if(m.test(s.email)){if(X(s.password)<8)return x("密码长度至少 8 位!");if(s.password!==s.re_password)return x("两次输入的密码不一致!")}else return x("邮箱格式错误!");const{code:a,message:l}=await se().$post("/api/frontend/user/insert",{},{body:s});a===200&&(x({type:"success",content:l}),c())});return(m,a)=>(b(),y("div",{class:J(["modal-wrap modal-signup-wrap",r.value?"active":""])},[os,e("div",as,[is,e("a",{href:"javascript:;",class:"modal-close",onClick:o},rs),e("div",cs,[e("form",us,[e("div",ds,[S(e("input",{"onUpdate:modelValue":a[0]||(a[0]=l=>p(s).username=l),type:"text",placeholder:"昵称",class:"base-input",name:"username"},null,512),[[L,p(s).username]]),ps]),e("div",ms,[S(e("input",{"onUpdate:modelValue":a[1]||(a[1]=l=>p(s).email=l),type:"text",placeholder:"邮箱",class:"base-input",name:"email"},null,512),[[L,p(s).email]]),hs]),e("div",fs,[S(e("input",{"onUpdate:modelValue":a[2]||(a[2]=l=>p(s).password=l),type:"password",placeholder:"密码",class:"base-input",autocomplete:"off",name:"password"},null,512),[[L,p(s).password]]),_s]),e("div",vs,[S(e("input",{"onUpdate:modelValue":a[3]||(a[3]=l=>p(s).re_password=l),type:"password",placeholder:"重复密码",class:"base-input",autocomplete:"off",name:"re_password"},null,512),[[L,p(s).re_password]]),ws]),e("a",{href:"javascript:;",class:"btn sign-up-btn btn-yellow",onClick:a[4]||(a[4]=(...l)=>p(d)&&p(d)(...l))},"确认注册"),e("a",{href:"javascript:;",class:"btn sign-up-btn btn-blue block",onClick:c},"直接登录")])])])],2))}}),gs=window.setInterval,ks={class:"back-top"},Ts=A({name:"BackTop",__name:"back-top",setup(u){const{y:n}=Me();function i(){let r=n.value;const t=gs(()=>{r-=Math.abs(r*.1),r<=1&&(r=0,clearInterval(t)),window.scrollTo(0,r)},20)}return(r,t)=>S((b(),y("div",ks,[e("a",{href:"javascript:;",onClick:i})],512)),[[me,p(n)>500]])}}),bs="#88888825",Ps=A({__name:"bg-plum",setup(u){const n=Math.PI,i=Math.PI/2,r=Math.PI/12,t=w(null),{random:s}=Math,o=O(Se()),c=w(()=>{}),d=w(4),m=w(6),a=w(!1);function l(v,g=400,M=400,R){const f=v.getContext("2d"),$=window.devicePixelRatio||1,C=f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1,k=$/C;return v.style.width=`${g}px`,v.style.height=`${M}px`,v.width=k*g,v.height=k*M,f.scale(k,k),{ctx:f,dpi:k}}function h(v=0,g=0,M=0,R=0){const f=M*Math.cos(R),$=M*Math.sin(R);return[v+f,g+$]}D(async()=>{const v=t.value,{ctx:g}=l(v,o.width,o.height),{width:M,height:R}=v;let f=[],$=[],C=0;const k=(j,G,N)=>{const oe=s()*m.value,[I,B]=h(j,G,oe,N);g.beginPath(),g.moveTo(j,G),g.lineTo(I,B),g.stroke();const ae=N+s()*r,ie=N-s()*r;I<-100||I>o.width+100||B<-100||B>o.height+100||((C<=d.value||s()>.5)&&f.push(()=>k(I,B,ae)),(C<=d.value||s()>.5)&&f.push(()=>k(I,B,ie)))};let H=performance.now();const ne=1e3/40;let W;W=$e(()=>{performance.now()-H<ne||(C+=1,$=f,f=[],H=performance.now(),$.length||(W.pause(),a.value=!0),$.forEach(j=>j()))},{immediate:!1}),c.value=()=>{W.pause(),C=0,g.clearRect(0,0,M,R),g.lineWidth=1,g.strokeStyle=bs,$=[],f=[()=>k(s()*o.width,0,i),()=>k(s()*o.width,o.height,-i),()=>k(0,s()*o.height,0),()=>k(o.width,s()*o.height,n)],o.width<500&&(f=f.slice(0,2)),W.resume(),a.value=!1},c.value()});const _=P(()=>"radial-gradient(circle, transparent, black);");return(v,g)=>(b(),y("div",{class:"pointer-events-none fixed bottom-0 left-0 right-0 top-0",style:he([{"z-index":"-1"},`mask-image: ${p(_)};--webkit-mask-image: ${p(_)};`])},[e("canvas",{ref_key:"el",ref:t,width:"400",height:"400"},null,512)],4))}}),ys={key:0,id:"app-refresh",class:"app-refresh"},$s={class:"app-refresh-wrap"},xs=e("label",null,"新内容可用，单击刷新按钮更新",-1),Vs=A({name:"ReloadPrompt",__name:"reload-prompt",setup(u){const{offlineReady:n,needRefresh:i,updateServiceWorker:r}=fe();async function t(){n.value=!1,i.value=!1}return(s,o)=>p(i)?(b(),y("div",ys,[e("div",$s,[xs,e("span",{onClick:o[0]||(o[0]=c=>p(r)())},"刷新"),e("span",{onClick:t},"关闭")])])):K("",!0)}});export{Is as _,Bs as a,Es as b,Ts as c,Ps as d,Vs as e};
