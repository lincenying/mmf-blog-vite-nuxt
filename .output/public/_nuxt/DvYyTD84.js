import{_ as L}from"./DC-Wy9T5.js";import{_ as N}from"./DqvCePol.js";import{d as R}from"./Dbq26dxh.js";import{d as S,F as T,u as F,J as E,K as P,L as G,r as u,Q as j,o as q,t as z,i as J,v as c,x as p,y as e,A as m,B as _,S as f,T as K,G as a,W as Q,M as W,N as X,z as Y,H as Z,I as O,X as tt,Y as et,Z as ot}from"./DPxB2w_0.js";import{u as st}from"./JrUFQDTA.js";import{u as at,b as nt,a as x}from"./DEefp4d8.js";import{u as lt,s as w}from"./Dg45MdiV.js";import{u as C}from"./B8RxlIE4.js";import"./B8H6CRKA.js";import"./CcbZIe53.js";const it={class:"settings-main card"},rt={class:"settings-main-content"},ct=e("span",{class:"input-info error"},"请输入标题",-1),dt=e("i",{class:"icon icon-arrow-down"},null,-1),ut=e("option",{value:""},"请选择分类",-1),pt=["value"],mt=e("span",{class:"input-info error"},"请输入分类",-1),_t={class:"settings-section"},ft={id:"post-content",class:"settings-item-content"},ht={class:"settings-footer"},gt={"mr-10px":"","inline-flex":"","items-center":""},vt=e("span",{"ml-5px":""},"使用前端生成Html?",-1),Ut=S({name:"BackendArticleInsert",__name:"insert",async setup(yt){let h,g;const M=R.useLoading(),$=T(),V=F(),v=st();[h,g]=E(()=>at("frontend-insert",()=>v.getCategoryList({limit:99,path:$.fullPath}))),await h,g();const B=P(v),D=G(B,"lists"),{data:U}=nt("backend-article-list");let y=u(!1);const r=u(!0),[A,b]=lt(!1),o=j({title:"",category:"",content:"",html:""});q(async()=>{y.value=!0});async function H(){var l;if(!o.title||!o.category||!o.content){w("请将表单填写完整!");return}if(A.value)return;if(b(!0),r.value){const i=ot.vMdParser.themeConfig.markdownParser.render(o.content);o.html=i}const{code:d,data:s,message:n}=await x().$post("/api/backend/article/insert",{},{body:o});b(!1),d===200&&(w({type:"success",content:n}),(l=U.value)==null||l.data.list.push(s),V.push("/_backend/article/list"))}async function I(d,s,n){const l=M.show(),i=new FormData;i.append("file",n[0]);try{const{data:t}=await x().$post(`${C}/api/fetch/upload`,{},{body:i});t&&t.filepath&&s({url:`${C}/${t.filepath}`,desc:""})}catch(t){console.log(t)}l.hide()}const k=u("发布文章 - M.M.F 小屋");return z({title:k,meta:[{name:"description",content:k}]}),(d,s)=>{const n=L,l=J("v-md-editor"),i=N;return c(),p("div",it,[e("div",rt,[m(n,{title:"标题"},{default:_(()=>[f(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>a(o).title=t),type:"text",placeholder:"标题",class:"base-input",name:"title"},null,512),[[K,a(o).title]]),ct]),_:1}),m(n,{title:"分类",classes:"select-item-wrap"},{default:_(()=>[dt,f(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>a(o).category=t),class:"select-item",name:"category"},[ut,(c(!0),p(W,null,X(D.value,t=>(c(),p("option",{key:t._id,value:`${t._id}|${t.cate_name}`},Y(t.cate_name),9,pt))),128))],512),[[Q,a(o).category]]),mt]),_:1}),e("div",_t,[e("div",ft,[m(i,null,{default:_(()=>[a(y)?(c(),Z(l,{key:0,modelValue:a(o).content,"onUpdate:modelValue":s[2]||(s[2]=t=>a(o).content=t),"disabled-menus":[],mode:"edit",height:"500px","left-toolbar":"undo redo clear | h bold italic strikethrough link | ul ol table hr | image quote code tip | save",onUploadImage:I},null,8,["modelValue"])):O("",!0)]),_:1})])])]),e("div",ht,[e("label",gt,[f(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>et(r)?r.value=t:null),type:"checkbox",value:"1"},null,512),[[tt,a(r)]]),vt]),e("a",{href:"javascript:;",class:"btn btn-yellow",onClick:H},"添加文章")])])}}});export{Ut as default};
