import{C as U,_ as O,a as W,b as X}from"./BECqvDc1.js";import{d as G,V as B,L as h,F as H,Q as Y,j as g,v as o,x as a,y as t,G as l,S as Z,T as tt,M as P,N as et,z as y,I as st,J as T,K as F,t as ot,i as at,A as i,B as j,C as f}from"./DPxB2w_0.js";import{u as nt}from"./Kw-0CWFx.js";import{u as I}from"./LNL3RY7w.js";import{u as ct,c as rt,s as q,a as D}from"./Dg45MdiV.js";import{a as it,u as N}from"./DEefp4d8.js";import{u as lt,_ as dt}from"./BVUqdimP.js";import{a as mt}from"./Dn_8v55Y.js";import{u as _t}from"./JrUFQDTA.js";import{u as ut}from"./CiqCsSE6.js";import"./CcbZIe53.js";import"./B8H6CRKA.js";const ht={class:"card"},pt={class:"comments"},vt={class:"comment-post-wrap"},ft=["src"],gt={class:"comment-post-input-wrap base-textarea-wrap"},yt={class:"comment-post-actions"},$t={class:"comment-items-wrap"},wt={href:"javascript:;",class:"comment-author-avatar-link"},kt=["src"],Ct={class:"comment-content-wrap"},bt={class:"comment-author-wrap"},xt={href:"javascript:;",class:"comment-author"},Lt={class:"comment-content"},At={class:"comment-footer"},St={class:"comment-time"},Mt=["onClick"],Tt={key:0,class:"load-more-wrap"},Ft={key:1,href:"javascript:;",class:"comments-load-more"},jt=G({name:"FrontendComment",__name:"frontend-comment",props:{comments:null},setup(R){const r=B(R),p=h(r,"comments"),m=nt(),$=B(m),v=h($,"cookies"),u=I(),[w,k]=ct(!1),C=H(),n=Y({id:C.query.id,content:""}),b=g(()=>v.value.user),L=g(()=>v.value.useremail);async function A(){k(!0),await u.getCommentList({id:C.query.id,page:p.value.page+1,limit:10}),k(!1)}const x=rt(async()=>{if(!b.value)q("请先登录!"),m.setLoginModal(!0);else if(n.content==="")q("请输入评论内容!");else{const{code:e,data:c}=await it().$post("/api/frontend/comment/insert",{},{body:n});e===200&&(n.content="",q({type:"success",content:"评论发布成功!"}),u.insertCommentItem(c))}});function S(e){var s;n.content=`回复 @${(s=e.userid)==null?void 0:s.username}: `,document.querySelector("#content").focus()}return(e,c)=>(o(),a("div",ht,[t("div",pt,[t("div",vt,[t("img",{src:("useAvatar"in e?e.useAvatar:l(D))(L.value),alt:"",class:"avatar-img"},null,8,ft),t("div",gt,[Z(t("textarea",{id:"content","onUpdate:modelValue":c[0]||(c[0]=s=>l(n).content=s),class:"base-input textarea-input",cols:"30",rows:"4"},null,512),[[tt,l(n).content]])]),t("div",yt,[t("a",{href:"javascript:;",class:"btn btn-blue",onClick:c[1]||(c[1]=(...s)=>l(x)&&l(x)(...s))},"发表评论")])]),t("div",$t,[(o(!0),a(P,null,et(p.value.data,s=>(o(),a("div",{key:s._id,class:"comment-item"},[t("a",wt,[t("img",{src:("useAvatar"in e?e.useAvatar:l(D))(s.userid.email),alt:"",class:"avatar-img"},null,8,kt)]),t("div",Ct,[t("span",bt,[t("a",xt,y(s.userid.username),1)]),t("div",Lt,y(s.content),1),t("div",At,[t("span",St,y(s.creat_date),1),t("a",{href:"javascript:;",class:"comment-action-item comment-reply",onClick:_=>S(s)},"回复",8,Mt)])])]))),128))]),p.value.hasNext?(o(),a("div",Tt,[l(w)?(o(),a("a",Ft,"加载中...")):(o(),a("a",{key:0,href:"javascript:;",class:"comments-load-more",onClick:A},"加载更多"))])):st("",!0)])]))}}),qt={class:"main wrap"},Nt={class:"main-left"},Rt={key:0,class:"card card-content-loader"},Vt=t("rect",{x:"70",y:"15",rx:"4",ry:"4",width:"117",height:"6.4"},null,-1),Bt=t("rect",{x:"70",y:"35",rx:"3",ry:"3",width:"85",height:"6.4"},null,-1),Dt=t("rect",{x:"0",y:"80",rx:"3",ry:"3",width:"550",height:"6.4"},null,-1),Gt=t("rect",{x:"0",y:"100",rx:"3",ry:"3",width:"620",height:"6.4"},null,-1),Ht=t("rect",{x:"0",y:"120",rx:"3",ry:"3",width:"401",height:"6.4"},null,-1),Pt=t("rect",{x:"0",y:"140",rx:"3",ry:"3",width:"501",height:"6.4"},null,-1),It=t("circle",{cx:"30",cy:"30",r:"30"},null,-1),Et={class:"card card-question-head"},zt={class:"question-content"},Jt={class:"question-title"},Kt={class:"card card-answer"},Qt={class:"answer-content"},Ut=["innerHTML"],Ot={key:2,class:"card card-answer"},Wt=t("div",{class:"answer-content"},"该文章不存在, 或者该文章已经被删除",-1),Xt=[Wt],Yt={class:"main-right"},me=G({name:"FrontendArticle",__name:"[id]",async setup(R){let d,r;const p=H(),m=mt("id"),$=p.fullPath,v=_t(),u=lt(),w=I();[d,r]=T(()=>N(`frontend-article-detail-${m.value}`,()=>Promise.all([w.getCommentList({id:m.value,path:$,page:1,limit:10}),u.getArticleItem({id:m.value,path:$})]))),await d,r(),[d,r]=T(()=>N("frontend-article-category",()=>v.getCategoryList({}))),await d,r(),[d,r]=T(()=>N("frontend-article-trending",()=>u.getTrending())),await d,r();const k=F(v),C=h(k,"lists"),n=F(u),b=h(n,"item"),L=h(n,"trending"),A=F(w),x=h(A,"lists"),S=g(()=>b.value.isLoad),e=g(()=>b.value.data);ut(`frontend-article-detail-${m.value}`);function c(_){return _?_.replace(/<a(.*?)href="http/g,'<a$1target="_blank" href="http'):""}const s=g(()=>{var M;let _="M.M.F 小屋";return _=(M=e.value)!=null&&M.title?`${e.value.title} - M.M.F 小屋`:"M.M.F 小屋",_});return ot({title:s,meta:[{name:"description",content:s}]}),(_,M)=>{const V=at("router-link"),E=O,z=jt,J=W,K=dt,Q=X;return o(),a("div",qt,[t("div",Nt,[S.value?e.value?(o(),a(P,{key:1},[t("div",Et,[t("div",zt,[i(V,{to:`/category/${e.value.category}`,class:"topic-link-item"},{default:j(()=>[f(y(e.value.category_name),1)]),_:1},8,["to"]),t("h2",Jt,[i(V,{to:`/article/${e.value._id}`,class:"question-title-link"},{default:j(()=>[f(y(e.value.title),1)]),_:1},8,["to"])])])]),t("div",Kt,[t("div",Qt,[t("div",{class:"markdown-body vuepress-markdown-body github-markdown-body article-content",innerHTML:c(e.value.html)},null,8,Ut)]),i(E,{item:e.value},null,8,["item"])]),i(z,{comments:x.value},null,8,["comments"])],64)):(o(),a("div",Ot,Xt)):(o(),a("div",Rt,[i(l(U),{height:160,width:660,speed:2,"primary-color":"#f3f3f3","secondary-color":"#ecebeb"},{default:j(()=>[Vt,f(),Bt,Dt,f(),Gt,Ht,f(),Pt,It]),_:1})]))]),t("div",Yt,[i(J,{category:C.value},null,8,["category"]),i(K,{trending:L.value},null,8,["trending"]),i(Q)])])}}});export{me as default};
